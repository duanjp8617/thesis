\chapter {\textit{ScalIMS}: Scaling IMS Service Chains Across Geo-distributed Datacenters}
\label{ch:scalims}
\lhead{\chaptername \ \ref{ch:scalims}.\ \emph{\textit{ScalIMS}}}

This chapter discusses the design and implementation of \textit{ScalIMS}. A brief introduction of \textit{ScalIMS} system is first given in section \ref{sec:scalims-introduction}, followed by an overview of IMS system in section \ref{sec:scalims-background}. The motivation for designing \textit{ScalIMS} and the major design highlights of \textit{ScalIMS} are given in section \ref{sec:scalims-motivation}. The major techniques for scaling the dataplane service chain and control plane service chain of the IMS system are described in section \ref{sec:scalims-cp} and \ref{sec:scalims-dp} respectively. Section \ref{sec:scalims-evaluation} demonstrates the performance of \textit{ScalIMS} system. Finally, we give concluding remarks in section \ref{sec:scalims-conclusion}.

\section{Introduction} \label{sec:scalims-introduction}

Traditional hardware-based network functions are notoriously hard and costly to deploy and scale. The recent paradigm of network function virtualization (NFV) advocates deploying software network functions in virtualized environments (e.g., VMs) on off-the-shelf servers, to significantly simplify deployment and scaling at much lowered costs~\cite{nfv-website}.

Despite the advantages, many problems remain when introducing NFV to the provisioning of practical network services. %, especially on dynamically scaling their service chains -- an ordered collection of virtual network functions (VNFs) that altogether compose a network service -- over a large geographical span.
 One problem is to design efficient VNF software, such that software VNFs can achieve packet processing speeds close to hardware middleboxes. Another is to design an efficient management system, which deploys and scales VNF service chains -- an ordered collection of VNFs that altogether compose a network service, according to the traffic demand. There have been efforts targeting architectural improvement of VNF software \cite{martins2014clickos}. A number of management systems have also been proposed \cite{palkar2015e2, gember2012stratos}, which operate VNF service chains deployed in a single server cluster or datacenter. These management systems are adequate for service chains such as ``firewall$\rightarrow$ intrusion detection system (IDS)'', %protect client-server based systems.
 which are typically used to provide access service to a client-server Web system, % and consisting of a firewall and an intrusion detection system (IDS) to access database and web services,
  deployed in the on-premise cluster/datacenter of the service provider.


  There are many other service chains which render a geo-distributed nature, e.g., the service chains in IP Multimedia Subsystems (IMS) \cite{3gpp-ims} and mobile core networks~\cite{epc} (examples presented in Fig.~\ref{fig:IMS_architecture}). In these systems, the network functions are desirably deployed close to geo-dispersed users, %However, they cannot be directly applied to other service chains that provide inter-connection services for users residing widely apart
 and putting the service chain in a single datacenter would be unfavourable as compared to distributing its VNFs across several datacenters. %, to enable low-delay access of the users to the network functions.
 The existing management systems cannot be directly applied to handle such geo-distributed service chains \cite{qazi2016klein}, due to the escalated challenges on efficient interconnection of VNFs over the WAN, dynamic decision making on how VNF instances are deployed in different datacenters, and optimally dispatching individual flows through the deployed instances.
 %and dynamic decision making on the numbers of VNF instances to deploy in different datacenters, adjusting them over time, and optimally dispatching individual flows through the deployed instances.



%Designing a management system for scaling geo-distributed service chains imposes new challenges over the existing approaches. How to provision VNF instances on different datacenters, how to adjust the provisioning over time with variation of traffic, and what VNF instances a service chain should go through at different datacenters are all important problems that must be well addressed.

This chapter presents \textit{ScalIMS}, a management system that enables dynamic deployment and scaling of VNF service chains across multiple datacenters, using representative control-plane and data-plane service chains of the IMS system \cite{3gpp-ims}. \textit{ScalIMS} is designed to provide good performance (minimal VNF instances deployment and guaranteed end-to-end flow delays), using both runtime statistics of VNFs and global traffic information. IMS is chosen as the target platform because of its important role in the telecom core networks as well as the accessibility of open-source software implementation of IMS \cite{project-clearwater}. \textit{ScalIMS} has two important characteristics that distinguish itself from existing management systems:

%\begin{itemize}
%\item
$\triangleright$ \textbf{Dynamic Scaling over Multiple Datacenters:} \textit{ScalIMS} dynamically deploys multiple instances of the same network function onto different datacenters according to real-time traffic demand and user distribution. The network paths that a service chain traverses are optimized to provide QoS guarantee of user traffic (i.e., bounded end-to-end delays). This feature distinguishes \textit{ScalIMS} from systems that can only scale service chains within a single datacenter \cite{palkar2015e2, gember2012stratos}.

%\item
$\triangleright$ \textbf{A Hybrid Scaling Strategy:} Most existing VNF management systems~\cite{wood2007black}~\cite{gember2012stratos} scale service chains using reactive approaches, adding/removing VNF instances by responding to changes of runtime status of existing VNFs. Novelly, \textit{ScalIMS} combines reactive scaling with proactive scaling, using predicted traffic volumes based on the history. This hybrid strategy exploits all opportunities for timely scaling of VNFs and significantly improves system performance.
%\end{itemize}

We evaluate \textit{ScalIMS} on IBM SoftLayer cloud. Experiment results show that \textit{ScalIMS} significantly improves QoS of user traffic compared with scaling systems that use only reactive or proactive scaling approaches. Meanwhile, \textit{ScalIMS} achieves this improvement %by either launching VNF instances timely or re-routing traffic to datacenters with redundant VNF instances,
 using almost $50\%$ less VNF instances. % When traffic re-routing takes effect, \textit{ScalIMS} achieves $30\%$ less VNF instance provisoining, while guaranteeing better QoS of user traffic. %the total number of provisioned VNF instances by at most $30\%$, when being compared with pure reactive based scaling approach.
%In this way, with \textit{ScalIMS}, service chains of an IMS can be deployed and scaled across multiple datacenters with QoS guarantee for user traffic and decreased operational cost of provisioning network function instances.
Even though \textit{ScalIMS} is designed for IMS systems, similar design principles can be easily applied to other NFV systems, which benefit from service chain deployment across multiple datacenters.

%In the rest of the paper, Sec.~\ref{Background} introduces basic concepts of NFV service chains and background of IMSs. Sec.~\ref{Motivation} presents our motivations and design highlights. Sec.~\ref{System-Design} gives the detailed design of \textit{ScalIMS}. We discuss an algorithm for inter-datacenter scaling of IMS data-plane service chains in Sec.~\ref{sec-dp-scaling}, present experiments in Sec.~\ref{Evaluation}, and conclude the paper in Sec.~\ref{}.

%The IP Multimedia Subsystem (IMS) is a standardized network architecture for delivering multimedia services in IP network to mobile users. Historically, deploying IMS would require a telecommunications service provider to purchase different kinds of proprietary network appliances, which leads to prohibitive capital expense for the service provider, let alone the difficulty in maintaining and upgrading IMS. But recently, the trend towards Network Function Virtualization (NFV) brings new vitality. On one hand, in the scenario of virtual IMS, a service provider could run software applications on virtual machines and deploy virtual network functions in computing clusters (i.e. in datacenters), facilitating maintenance and upgrade. On the other hand, the provisioning of virtual IMS could be dynamically scaled according to run-time traffic, which contributes to better performance under high workload and saves operating cost under low workload.

%Meanwhile, the technology that supports this virtualization is also mature. For example, the products of open source IMS functions \cite{clearwater} are easily available on the web. The performance of virtual machines in the state-of-the-art platforms like KVM and Xen is comparable with bare metal servers. Moreover, software-defined networking enables us to flexibly control network and complete complex network routing and management tasks. At last, building a large commodity datacenter becomes easier and cheaper than before and many large telecoms possesses their own datacenters in multiple sites.

%Even with all these good news, saving cost while guaranteeing Quality of Service (QoS) is still difficult due to the high requirements of IMS: low packet loss, delay and jitter. A widely adopted way is to utilize the scalibility of cloud to achieve cost saving. While it is feasible, the performance is barely satisfactory. First, existing works \cite{gember2013stratos, wood2007black} mostly scope in a single datacenter, where the whole service functions are located together. Although this may be a good deployment for a client-server based system, such as database, it does not suit well with IMS which provides interactive connection services for users spanning across a large geographical region. For example, a caller in New York and a callee in Hong Kong may always suffer long-latency and high-jitter call experience. Second, they usually take a reactive scaling approach that takes actions after detecting overload. However, there is an unelectable and unpredictable delay because launching a virtual machine requires at least half minutes. Besides, we observe that virtual machines have a tendency to become overloaded simultaneously due to load balancing, causing severe QoS violation during the scaling process.

%To overcome these limitations in today's IMS deployment and scaling, we design, implement and evaluate \textit{ScalIMS}, a dynamic scaling system for IMS across geo-distributed datacenters. ScalIMS adopts the following two approaches to achieve excellent scaling performance and satisfactory service quality.

%First, we argue to deploy a service across multiple sites and utilize low-latency inter-datacenter networks to transit user traffic. \textbf{[more reasons why we do so]} However, designing a multi-datacenter scaling system means that a single network service will be deployed on different datacenters. Besides, IMS traffic does not have definitive destination addresses because telecom service providers usually allocate private addresses to mobile users. How to correctly and efficiently route traffic according to service logic imposes a challenge here. Luckily we are able to design a distributed routing framework using address information provided by control messages and flow tagging.

%Second, we take a mixed scaling strategy that combines reactive scaling with proactive scaling together. Specifically, at coarse time scale, ScalIMS periodically calculates proactive scaling result based on resource provision and workload prediction; at fine time scale, ScalIMS actively collects runtime statistics and executes reactive scaling. A combination of both not only decreases the possibility of overloaded virtual machines, thus mitigating QoS violation during reactive scaling process, but also compensates for the inaccuracy of prediction, thereby increasing the overall system performance under sudden traffic surges.

%Our prototype implementation of ScalIMS shows ...\textbf{[state experiment result here in one or two sentences]}... The remainder of this paper is organized as follows. Section 2 provides further background about IMS architecture and service chain. Section 3 describes the system design, including traffic routing and scaling workflow in control plane and data plane respectively. Section 4 covers problem model and the proactive scaling algorithm. Our prototype implementation and evaluation is described in section 5 and 6. Before concluding, we discuss possible doubts and related work.
